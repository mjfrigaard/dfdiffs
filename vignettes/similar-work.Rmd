---
title: "similar-work"
output: 
  rmarkdown::html_vignette:
    toc: yes
    toc_depth: 4
vignette: >
  %\VignetteIndexEntry{similar-work}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(knitr)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  error = TRUE,
  message = FALSE,
  warning = FALSE,
  echo = TRUE
)
options(
  rmarkdown.html_vignette.check_title = FALSE,
  tibble.print_max = Inf)
extdata_folder <- "../inst/extdata/"
```

# Motivation 

This vignette covers similar functions/packages that compare two datasets to each other. 

## Packages 

Our package

```{r dfdiffs, echo = TRUE}
library(dfdiffs)
```

Packages for import/export, iteration, wrangling, etc. 

```{r more-pkgs, message=FALSE, warning=FALSE, echo = TRUE}
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(purrr)
library(glue)
```

Packages for tables.

```{r tbl-pkgs, message=FALSE, warning=FALSE, echo = TRUE}
library(labelled)
library(gt)
library(gtsummary)
library(kableExtra)
```


Similar packages 

```{r similar-pkgs, message=FALSE, warning=FALSE, echo = TRUE}
library(janitor) # compare_df_cols
library(testthat) # expect_equal
library(vetr) # alike
library(labelled)
library(gt)
library(gtsummary)
```

## Data 

We'll be using the data in this package to cover similar `packages::functions()`. 

### New data

To check new data, we're going to use `T1Data` and `T2Data`. The `create_new_data()` function shows us the 'new data' (i.e. what is here now that wasn't here before?)

We can check this against the `NewData` dataset (which should match the output from `create_new_data()`)

```{r T1Data-T2Data-NewData, echo=TRUE}
T1Data <- dfdiffs::T1Data
T2Data <- dfdiffs::T2Data
T1T2New <- create_new_data(compare = T2Data, base = T1Data)
T1T2New |> 
  knitr::kable(caption = "New data T1 > T2") |> 
  kableExtra::kable_paper()
```

```{r NewData, echo=TRUE}
NewData <- dfdiffs::NewData
NewData |> 
  knitr::kable(caption = "New data (Comparison)") |> 
  kableExtra::kable_paper()
```


We can see the only differences between the datasets are the formats of the date columns:

```{r waldo-compare-T1T2New-NewData}
waldo::compare(x = T1T2New, y = NewData)
```


###  Deleted data 

To test for the deleted data, we use the `CompleteData`, `IncompleteData`, and `DeletedData`. 

`CompleteData` represents a 'complete' set of data, 

```{r CompleteData}
CompleteData <- dfdiffs::CompleteData
CompleteData |> 
  knitr::kable(caption = "CompleteData") |> 
  kableExtra::kable_paper()
```


and `IncompleteData` is a dataset with rows removed from `CompleteData`. 

```{r IncompleteData}
IncompleteData <- dfdiffs::IncompleteData
IncompleteData |> 
  knitr::kable(caption = "IncompleteData") |> 
  kableExtra::kable_paper()
```


When we run the `create_deleted_data()`, we check for the deleted rows between `IncompleteData` and `CompleteData`.

```{r CompleteData-IncompleteData, echo = TRUE}
IncompCompDiff <- create_deleted_data(
  compare = IncompleteData, 
  base = CompleteData) |> 
  arrange(subject)
IncompCompDiff |> 
  knitr::kable(caption = "IncompCompDiff") |> 
  kableExtra::kable_paper()
```

This is identical to the data stored in `DeletedData`

```{r DeletedData}
DeletedData <- dfdiffs::DeletedData
DeletedData |> 
  knitr::kable(caption = "DeletedData") |> 
  kableExtra::kable_paper()
```


```{r waldo-compare-IncompCompDiff-DeletedData}
waldo::compare(x = IncompCompDiff, y = DeletedData)
```

### InitialData/ChangedData Data 

To check for changes between two datasets, we uses the `InitialData` and `ChangedData`. 

```{r InitialData-ChangedData, echo=TRUE}
InitialData <- dfdiffs::InitialData
ChangedData <- dfdiffs::ChangedData
mods <- create_modified_data(
  compare = ChangedData, base = InitialData)
```

The changes by variable are stored in `diffs_byvar`.

```{r diffs_byvar}
mods$diffs_byvar |> 
  knitr::kable(caption = "diffs_byvar") |> 
  kableExtra::kable_paper()
```

The changes by row are stored in `diffs`.

```{r diffs}
mods$diffs |> 
  knitr::kable(caption = "diffs") |> 
  kableExtra::kable_paper()
```


## `janitor::compare_df_cols_same()`

The `compare_df_cols_same()` function from `janitor` compares two datasets and "*indicates if they will successfully bind together by rows.*"

```{r compare_df_cols_same, echo=TRUE}
compare_df_cols_same(T1Data, T2Data, strict_description = FALSE)
compare_df_cols_same(CompleteData, IncompleteData, strict_description = FALSE)
compare_df_cols_same(InitialData, ChangedData, strict_description = FALSE)
```

All of our test datasets meet this condition, but this could be used as a step in one our `create_` functions (to see if they can be successfully bound together).

## `testthat::expect_equal()`

This works, but returns the result as an error. 

```{r expect_equal-initial-changed, error=TRUE}
testthat::expect_equal(object = InitialData, expected = ChangedData)
```

```{r expect_equal-t1data-t2data, error=TRUE}
testthat::expect_equal(object = T1Data, expected = T2Data)
```


## `vetr::alike()`

```{r}
vetr::alike(target = InitialData, current = ChangedData)
```

